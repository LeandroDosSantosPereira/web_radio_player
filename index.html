<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
		integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w=="
		crossorigin="anonymous" />
	<link rel="preconnect" href="https://fonts.gstatic.com" />
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />

	<link rel="stylesheet" href="assets\css\styles.css" />
</head>

<body>

	<body>
		<div class="player">
			<!-- Dashboard -->
			<div class="dashboard">
				<!-- Header -->
				<header>
					<h4>Tocando agora:</h4>
					<h2>Song Name</h2>
				</header>

				<!-- CD -->
				<div class="cd">
					<div class="cd-thumb" style="	background-color: #212121;"></div>
				</div>

				<!-- Control -->
				<div class="control">
					<div class="btn btn-repeat" style="display: none;">
						<i class="fas fa-redo"></i>
					</div>
					<div class="btn btn-prev">
						<i class="fas fa-step-backward"></i>
					</div>
					<div class="btn btn-toggle-play">
						<i class="fas fa-pause icon-pause"></i>
						<i class="fas fa-play icon-play"></i>
					</div>
					<div class="btn btn-new">
						<i class="fas fa-step-forward"></i>
					</div>
					<div class="btn btn-random" style="display: none;">
						<i class="fas fa-random"></i>
					</div>
				</div>

				<input id="progress" class="progress" type="range" value="0" step="0.1" min="0" max="100" />

				<audio id="audio" src=""></audio>
			</div>

			<!-- Playlist -->
			<div class="playlist">
				<div class="song">
					<div class="thumb" style="
							background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg');"></div>					
					<div class="option">
						<i class="fas fa-ellipsis-h"></i>
					</div>
				</div>
			
			</div>
		</div>
	</body>

	<style>
		:root {
			--primary-color: #1DB954;
			--text-color: white;
		}

		* {
			padding: 0;
			margin: 0;
			box-sizing: inherit;
		}

		body {
			background-color: #191414;
		}

		html {
			box-sizing: border-box;
			font-family: "Poppins", sans-serif;
		}

		.player {
			position: relative;
			max-width: 480px;
			margin: 0 auto;
		}

		.player .icon-pause {
			display: none;
		}

		.player.playing .icon-pause {
			display: inline-block;
		}

		.player.playing .icon-play {
			display: none;
		}

		.dashboard {
			padding: 16px 16px 14px;
			background-color: #212121;
			position: fixed;
			top: 0;
			width: 100%;
			max-width: 480px;
			border-bottom: 1px solid #212121;
		}

		/* HEADER */
		header {
			text-align: center;
			margin-bottom: 10px;
		}

		header h4 {
			color: var(--primary-color);
			font-size: 12px;
		}

		header h2 {
			color: var(--text-color);
			font-size: 20px;
		}

		/* CD */
		.cd {
			display: flex;
			margin: auto;
			width: 200px;
		}

		.cd-thumb {
			width: 100%;
			padding-top: 100%;
			border-radius: 50%;
			background-color: #333;
			background-size: cover;
			margin: auto;
		}

		/* CONTROL */
		.control {
			display: flex;
			align-items: center;
			justify-content: space-around;
			padding: 18px 0 8px 0;
		}

		.control .btn {
			color: #666;
			padding: 18px;
			font-size: 18px;
		}

		.control .btn:active {
			color: var(--primary-color);
		}

		.btn.active {
			color: var(--primary-color);
		}

		.control .btn:hover {
			cursor: pointer;
		}

		.control .btn-toggle-play {
			width: 56px;
			height: 56px;
			border-radius: 50%;
			font-size: 24px;
			color: #fff;
			display: flex;
			align-items: center;
			justify-content: center;
			background-color: var(--primary-color);
		}

		.progress {
			width: 100%;
			-webkit-appearance: none;
			height: 6px;
			background: #d3d3d3;
			outline: none;
			opacity: 0.7;
			-webkit-transition: 0.2s;
			transition: opacity 0.2s;
		}

		.progress::-webkit-slider-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 12px;
			height: 6px;
			background-color: var(--primary-color);
			cursor: pointer;
		}

		/* PLAYLIST */
		.playlist {
			margin-top: 408px;
			padding: 12px;
		}

		.song {
			display: flex;
			align-items: center;
			margin-bottom: 12px;
			background-color: #212121;
			padding: 8px 16px;
			border-radius: 5px;
			box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
		}

		.song:hover {
			cursor: pointer;
		}

		.song.active {
			background-color: var(--primary-color);
		}

		.song:active {
			opacity: 0.8;
		}

		.song.active .option,
		.song.active .author,
		.song.active .title {
			color: #fff;
		}

		.song .thumb {
			width: 44px;
			height: 44px;
			border-radius: 50%;
			background-size: cover;
			margin: 0 8px;
		}

		.song .body {
			flex: 1;
			padding: 0 16px;
		}

		.song .title {
			font-size: 18px;
			color: #1db954;
		}

		.song .author {
			font-size: 12px;
			color: #1db954;
		}

		.song .option {
			padding: 16px 8px;
			color: #999;
			font-size: 18px;
		}
	</style>

	<script>


		/**
	 * To do in this app:
	 * 1. Display the song playing
	 * 2. Play the sone
	 * 3. Pause the song playing
	 * 4. Keep the song repeatedly playing
	 * 5. new song
	 * 6. Previous song
	 * 7. Play the new song randomly
	 * 8. Select the song to play.
	 * 9. Scroll active songs
	 */

		const $ = document.querySelector.bind(document);
		const $$ = document.querySelectorAll.bind(document);

		const PLAYER_STORAGE_KEY = "MUSIC_PLAYER_STORAGE";

		const heading = $("header h2");
		const cdThumb = $(".cd-thumb");
		const audio = $("#audio");
		const cd = $(".cd");
		const playBtn = $(".btn-toggle-play");
		const player = $(".player");
		const progress = $(".progress");
		const btnNext = $(".btn-new");
		const btnPrev = $(".btn-prev");
		const btnRepeat = $(".btn-repeat");
		const btnRandom = $(".btn-random");
		const playlist = $(".playlist");
		const song = $(".song");

		const app = {
			currentIndex: 0,
			isPlaying: false,
			isRandom: false,
			isRepeated: false,
			config: JSON.parse(localStorage.getItem(PLAYER_STORAGE_KEY)) || {},
			setConfig: function (key, value) {
				this.config[key] = value;
				localStorage.setItem(PLAYER_STORAGE_KEY, JSON.stringify(this.config));
			},
			songs: [
				{
					name: "CBN",
					singer: "São Paulo",
					path: "https://27323.live.streamtheworld.com/CBN_SPAAC.aac?dist=radioscombr",
					image: ""
				},

				{
					name: "Tupi",
					singer: "Rio de Janeiro",
					path: "https://8923.brasilstream.com.br/stream?1699577978349",
					image: ""
				},
				{
					name: "Bandeirantes",
					singer: "São Paulo",
					path: "https://27573.live.streamtheworld.com/RADIOBANDEIRANTESAAC.aac?dist=radios.com.br",
					image: ""
				},
				{
					name: "Kiss The Heavens ",
					singer: "Asher Fulero",
					path: "./assets/audio/song4.mp3",
					image: "./assets/image/img1.jpg"
				},
				{
					name: "Pray",
					singer: "Anno Domini Beats",
					path: "./assets/audio/song5.mp3",
					image: "./assets/image/img1.jpg"
				},
				{
					name: "Skylines",
					singer: "Anno Domini Beats",
					path: "./assets/audio/song6.mp3",
					image: "./assets/image/img6.jpg"
				},
				{
					name: "Your Love",
					singer: "Young Logos",
					path: "./assets/audio/song7.mp3",
					image: "./assets/image/img6.jpg"
				},
				{
					name: "Break Your Lock and Key",
					singer: "Mini Vandals",
					path: "./assets/audio/song8.mp3",
					image: "./assets/image/img6.jpg"
				}
			],

			render: function () {
				const htmls = this.songs.map((song, index) => {
					return `
			             <div class="song ${index === this.currentIndex ? "active" : ""
						}" data-index = ${index}>
					        <div class="thumb" style="background-image: url('${song.image}')">
                      		</div>
					        <div class="body">
						        <h3 class="title">${song.name}</h3>
						        <p class="author">${song.singer}</p>
					        </div>
					        <div class="option">
						        <i class="fas fa-ellipsis-h"></i>
					        </div>
				         </div>`;
					//['']
				});
				playlist.innerHTML = htmls.join("\n");
			},

			//define properties for the app object
			defineProperties: function () {
				Object.defineProperty(this, "currentSong", {
					get: function () {
						return this.songs[this.currentIndex];
					}
				});
			},

			// Handle the events
			handleEvents: function () {
				const _this = this;
				//handle the scrolling
				const cdWidth = cd.offsetWidth; //to get the original width of CD element
				document.onscroll = function () {
					const scrollTop = window.scaleY || document.documentElement.scrollTop; // to get the number of pixels users scroll
					const newCdWidth = cdWidth - scrollTop;

					newCdWidth > 0 ? (cd.style.width = newCdWidth + "px") : 0; //set the new width for the CD
					cd.style.opacity = newCdWidth / cdWidth; //set the opacity for the CD
				};

				//handle cd's spinning animation
				const cdThumbAnimate = cdThumb.animate([{ transform: "rotate(360deg)" }], {
					duration: 10000, //10s
					interations: Infinity
				});

				//play/pause the song
				playBtn.onclick = function () {
					if (_this.isPlaying) {
						audio.pause();
					} else {
						audio.play();
					}

					//when the song is playing
					audio.onplay = function () {
						_this.isPlaying = true;
						player.classList.add("playing");
						cdThumbAnimate.play();
					};

					//show the progress
					audio.ontimeupdate = function () {
						const progressPercent = Math.floor(
							(this.currentTime / audio.duration) * 100
						);
						progress.value = progressPercent;
					};

					//move to a new position in the audio
					progress.onchange = function (e) {
						const seekTime = (e.target.value / 100) * audio.duration;
						audio.currentTime = seekTime;
					};

					//when this song is paused
					audio.onpause = function () {
						_this.isPlaying = false;
						player.classList.remove("playing");
						cdThumbAnimate.pause();
					};
				};
				//when a user clicks the Next button
				btnNext.onclick = function () {
					if (_this.isRandom) {
						_this.loadRandomSong();
					} else {
						_this.loadNextSong();
					}
					audio.play();
					_this.render();
					_this.scrollActiveSong();
				};

				//when a user clicks the Previous button
				btnPrev.onclick = function () {
					if (_this.isRandom) {
						_this.loadRandomSong();
					} else {
						_this.loadPrevSong();
					}
					audio.play();
					_this.render();
					_this.scrollActiveSong();
				};

				//when a user clicks the random button
				btnRandom.onclick = function () {
					_this.isRandom = !_this.isRandom;
					_this.loadRandomSong();
					_this.setConfig("isRandom", _this.isRandom);
					btnRandom.classList.toggle("active", _this.isRandom);
					audio.play();
				};

				//when a user clicks the repeat button
				btnRepeat.onclick = function () {
					_this.isRepeated = !_this.isRepeated;
					if (_this.isRandom) {
						_this.isRandom = false;
						_this.setConfig("isRepeated", _this.isRepeated);
					}
					btnRepeat.classList.toggle("active", _this.isRepeated);
				};

				//when the current playlist is ended
				audio.onended = function () {
					if (_this.isRepeated) {
						audio.play();
					} else {
						btnNext.click();
					}
				};

				//listen to click events on the playlist.
				playlist.onclick = function (e) {
					const songNode = e.target.closest(".song");
					//handle the click on a song
					if (e.target.closest(".song:not(.active)") || !e.target.closest(".option")) {
						_this.currentIndex = Number(songNode.dataset.index);
						_this.loadCurrentSong();
						_this.render();
						audio.play();
					}
				};
			},

			//load the current song which is playing
			loadCurrentSong: function () {
				heading.innerText = this.currentSong.name;
				cdThumb.style.backgroundImage = `url('${this.currentSong.image}')`;
				audio.src = this.currentSong.path;
			},
			//load config
			loadConfig: function () {
				this.isRandom = this.config.isRandom;
				this.isRepeated = this.config.isRepeated;
				btnRandom.classList.toggle("active", this.isRandom);
				btnRepeat.classList.toggle("active", this.isRepeated);
			},

			//Load the next song
			loadNextSong: function () {
				this.currentIndex++;
				if (this.currentIndex >= this.songs.length) {
					this.currentIndex = 0;
				}
				this.loadCurrentSong();
			},

			//load the previous song
			loadPrevSong: function () {
				this.currentIndex--;
				if (this.currentIndex < 0) {
					this.currentIndex = this.songs.length - 1;
				}
				this.loadCurrentSong();
			},

			//play a random song
			loadRandomSong: function () {
				let newIndex;
				do {
					newIndex = Math.floor(Math.random() * this.songs.length);
				} while (newIndex === this.currentIndex);

				this.currentIndex = newIndex;
				this.loadCurrentSong();
			},

			//scroll the active song to view
			scrollActiveSong: function () {
				setTimeout(() => {
					$(".song.active").scrollIntoView({ behavior: "smooth", block: "nearest" });
				}, 500);
			},

			start: function () {
				//load config
				this.loadConfig();

				//define the properties for the app object
				this.defineProperties();

				//default, play the current song

				//listen and handle DOM events
				this.handleEvents();

				//load a song to play
				this.loadCurrentSong();

				//reder the playlist
				this.render();
			}
		};

		app.start();

	</script>

</body>

</html>